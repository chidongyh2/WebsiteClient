<h1 class="page-title">
    <span class="cm-mgr-5" i18n="@@listProductPageTitle">Danh sách sản phẩm</span>
    <small i18n="@@productModuleTitle">Quản lý sản phẩm</small>
</h1>
<form class="form-inline cm-mgb-10" (ngSubmit)="search(1)">
    <div class="form-group cm-mgr-5">
        <input type="text" class="form-control" i18n-placeholder="@@keywordSearch"
               placeholder="Vui lòng nhập từ khóa tìm kiếm."
               name="searchInput" [(ngModel)]="keyword">
    </div>
    <div class="form-group cm-mgr-5">
        <nh-dropdown-tree [data]="categoryTree"
                          i18n-title="@@selectCategoryNews"
                          [title]="'-- Chọn nhóm sản phẩm --'"
                          [width]="350"
                          [(ngModel)]="categoryId"
                          name="categoryId"
                          (nodeSelected)="selectCategory($event)"></nh-dropdown-tree>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-select
            [data]="[{id: false, name: 'Không quản lý theo lô'},{id: true, name: 'Quản lý theo lô'}]"
            i18n-title="@@selectStatus"
            [title]="'-- Tất cả --'"
            [(value)]="isManagementByLot"
            (onSelectItem)="selectIsManagementByLot($event)"></nh-select>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-select
            [data]="[{id: false, name: 'Chưa kích hoạt'},{id: true, name: 'Đã kích hoạt'}]"
            i18n-title="@@selectStatus"
            [title]="'-- Tất cả --'"
            [(value)]="isActive"
            (onSelectItem)="selectIsActive($event)"></nh-select>
    </div>
    <div class="form-group">
        <button class="btn blue" type="submit">
            <i class="fa fa-search" *ngIf="!isSearching"></i>
            <i class="fa fa-pulse fa-spinner" *ngIf="isSearching"></i>
        </button>
    </div>
    <div class="form-group cm-mgl-5">
        <button class="btn default" type="button" (click)="resetFormSearch()">
            <i class="fa fa-refresh"></i>
        </button>
    </div>
    <div class="form-group pull-right">
        <a class="btn blue cm-mgr-5" *ngIf="permission.add" i18n="@@add"
           (click)="add()"
           type="button">
            Thêm
        </a>
    </div>
</form>
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th class="middle center w50" i18n="@@no">STT</th>
        <th class="middle" i18n="@@product">Sản phẩm</th>
        <th class="middle w200" i18n="@@productCategory">Nhóm sản phẩm</th>
        <th class="middle center w100" i18n="@@unitDefault">Đơn vị tính</th>
        <th class="middle w150  center" i18n="@@consignmentManagement">Theo lô</th>
        <th class="middle w150  center" i18n="@@consignmentManagement">Trạng thái duyệt</th>
        <th class="middle center w100" i18n="@@status">Kích hoạt</th>
        <th class="middle text-right w150" i18n="@@action" *ngIf="permission.edit || permission.delete">Hành động</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let item of listProduct; let i = index"
        nhContextMenuTrigger
        [nhContextMenuTriggerFor]="nhMenu"
        [nhContextMenuData]="item">
        <td class="center middle">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
        <td class="middle">
            <div class="media" [class.cursor-pointer]="permission.view" (click)="permission.view ? detail(item) : ''"
                 title="{{item.name}}">
                <div class="media-left middle">
                    <img ghmImage="" [src]="item.thumbnail" [isUrlAbsolute]="true" class="media-object w50"
                         alt="{{item.thumbnail}}">
                </div>
                <div class="media-body middle">
                    <h4 class="media-heading">{{ item.name }}</h4>
                </div>
            </div>
        </td>
        <td class="middle">
            {{item.categoryName}}
        </td>
        <td class="middle center">
            {{item.defaultUnit}}
        </td>
        <td class="middle center">
            <mat-checkbox color="primary" [checked]="item.isManagementByLot"
                          (change)="updateManagementByLot(item)"></mat-checkbox>
        </td>
        <td class="middle center">
            <span *ngIf="item.status === productStatus.Approve" class="badge badge-success">Approved</span>
            <span *ngIf="item.status === productStatus.Decline" class="badge badge-dark">Decline</span>
            <span *ngIf="item.status === productStatus.pending && permission.approve" [swal]="confirmApprove" (confirm)="updateApprove(item.id)" class="badge badge-warning cursor-pointer">Pending</span>
            <span *ngIf="item.status === productStatus.pending && !permission.approve" class="badge badge-secondary">Pending</span>
            <span *ngIf="item.status === productStatus.draft" class="badge badge-default">Draft</span>
        </td>
        <td class="middle center">
            <mat-checkbox color="primary" [checked]="item.isActive" (change)="updateStatus(item)"></mat-checkbox>
        </td>
        <td class="text-right middle" *ngIf="permission.edit || permission.delete">
            <nh-dropdown>
                <button type="button" class="btn btn-sm btn-light btn-no-background no-border" matTooltip="Menu">
                    <mat-icon>more_horiz</mat-icon>
                </button>
                <ul class="nh-dropdown-menu right" role="menu">
                    <li>
                        <a *ngIf="permission.view"
                           (click)="detail(item)">
                            <!--<i class="fa fa-eye"></i>-->
                            <mat-icon class="menu-icon">info</mat-icon>
                            <span i18n="@@detail">Chi tiết</span>
                        </a>
                    </li>
                    <li>
                        <a *ngIf="permission.edit"
                           (click)="edit(item.id)">
                            <!--<i class="fa fa-edit"></i>-->
                            <mat-icon class="menu-icon">edit</mat-icon>
                            <span i18n="@@edit">Chỉnh sửa</span>
                        </a>
                    </li>
                    <li>
                        <a (click)="confirm(item)">
                            <!--<i class="fa fa-trash"></i>-->
                            <mat-icon class="menu-icon">delete</mat-icon>
                            <span i18n="@@delete">Xóa</span>
                        </a>
                    </li>
                </ul>
            </nh-dropdown>
        </td>
    </tr>
    </tbody>
</table>

<div dynamic-component-host></div>

<ghm-paging
    class="pull-right"
    [totalRows]="totalRows"
    [currentPage]="currentPage"
    [pageShow]="6"
    [pageSize]="pageSize"
    (pageClick)="search($event)"
    i18n="@@product" i18n-pageName
    [pageName]="'product'">
</ghm-paging>

<swal
    #confirmDeleteProduct
    i18n="@@confirmDeleteProduct"
    i18n-title="@@confirmTitleDeleteProduct"
    i18n-text="@@confirmTextDeleteProduct"
    title="Are you sure for delete this product?"
    text="You can't recover this product after delete."
    type="question"
    i18n-confirmButtonText="@@accept"
    i18n-cancelButtonText="@@cancel"
    confirmButtonText="Accept"
    cancelButtonText="Cancel"
    [showCancelButton]="true"
    [focusCancel]="true">
</swal>

<swal
    #confirmApprove
    i18n="@@confirmApprove"
    i18n-title="@@confirmApprove"
    i18n-text="@@confirmApprove"
    title="Are you want approve this product?"
    type="question"
    i18n-confirmButtonText="@@accept"
    i18n-cancelButtonText="@@cancel"
    confirmButtonText="Accept"
    cancelButtonText="Cancel"
    [showCancelButton]="true"
    [focusCancel]="true">
</swal>
<nh-menu #nhMenu>
    <nh-menu-item (clicked)="detail($event)">
        <!--<i class="fa fa-eye menu-icon"></i>-->
        <mat-icon class="menu-icon">info</mat-icon>
        <span i18n="@@view">Chi tiết</span>
    </nh-menu-item>
    <nh-menu-item (clicked)="edit($event.id)">
        <mat-icon class="menu-icon">edit</mat-icon>
        <span i18n="@@edit">Chỉnh sửa</span>
    </nh-menu-item>
    <nh-menu-item *ngIf="permission.delete"
                  (clicked)="confirm($event)">
        <mat-icon class="menu-icon">delete</mat-icon>
        <span i18n="@@edit">Xóa</span>
    </nh-menu-item>
</nh-menu>
