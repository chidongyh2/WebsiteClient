<h1 class="page-title">
    <span class="cm-mgr-5" i18n="@@listSupplierPageTitle">Báo cáo tồn kho</span>
    <small i18n="@@productModuleTitle">Quản lý sản phẩm</small>
</h1>
<form class="form-inline cm-mgb-10" (ngSubmit)="search(1)">
    <div class="form-group cm-mgr-5">
        <app-warehouse-suggestion
            (itemSelected)="onWarehouseSelected($event)"></app-warehouse-suggestion>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-date name="fromDate" [(ngModel)]="fromDate"
                 [showTime]="true"
                 [mask]="true"
                 [allowRemove]="true"></nh-date>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-date name="toDate" [(ngModel)]="toDate" [mask]="true"
                 [showTime]="true"
                 [allowRemove]="true"></nh-date>
    </div>
    <div class="form-group cm-mgr-5">
        <input type="text" class="form-control" i18n="@@keywordSearch" i18n-placeholder
               placeholder="Enter keyword for search please."
               name="searchInput" [(ngModel)]="keyword">
    </div>
    <div class="form-group">
        <button class="btn blue" type="submit">
            <i class="fa fa-search" *ngIf="!isSearching"></i>
            <i class="fa fa-pulse fa-spinner" *ngIf="isSearching"></i>
        </button>
    </div>
    <!--<div class="form-group cm-mgl-5">-->
        <!--<button class="btn default" type="button" (click)="resetFormSearch()">-->
            <!--<i class="fa fa-refresh"></i>-->
        <!--</button>-->
    <!--</div>-->
</form>
<div class="table-responsive">
    <table class="table table-bordered table-striped table-hover">
        <thead>
        <tr>
            <th class="middle center w50" rowspan="2" i18n="@@no">STT</th>
            <th class="middle center w250" rowspan="2" i18n="@@receiptNo">Tên sản phẩm</th>
            <th class="middle center w250" rowspan="2" i18n="@@unit">Đơn vị tính</th>
            <th class="middle center" i18n="@@invoiceNo" colspan="2">Tồn đầu</th>
            <th class="middle center" i18n="@@entryDate" colspan="2">Nhập</th>
            <th class="middle center" i18n="@@supplier" colspan="2">Xuất</th>
            <th class="middle center text-right" i18n="@@totalItems" colspan="2">Tồn cuối</th>
        </tr>
        <tr>
            <th class="center w100">Số tiền</th>
            <th class="center w100">Số lượng</th>
            <th class="center w100">Số tiền</th>
            <th class="center w100">Số lượng</th>
            <th class="center w100">Số tiền</th>
            <th class="center w100">Số lượng</th>
            <th class="center w100">Số tiền</th>
            <th class="center w100">Số lượng</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of listItems$ | async; let i = index" (click)="detail(item.productId)"
            class="cursor-pointer">
            <td class="center">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td><a href="javascript://">{{ item.productName }}</a></td>
            <td>{{ item.unitName }}</td>
            <td class="text-right">{{ item.openingStockValue | ghmCurrency }}</td>
            <td class="text-right">{{ item.openingStockQuantity | ghmCurrency }}</td>
            <td class="text-right">{{ item.receivingValue | ghmCurrency }}</td>
            <td class="text-right">{{ item.receivingQuantity | ghmCurrency }}</td>
            <td class="text-right"
                [class.color-red]="item.deliveringValue < 0">{{ item.deliveringValue | ghmCurrency }}
            </td>
            <td class="text-right">{{ item.deliveringQuantity | ghmCurrency}}</td>
            <td class="text-right" [class.color-red]="item.closingStockValue < 0">
                {{ item.closingStockValue | ghmCurrency }}
            </td>
            <td class="text-right"
                [class.color-red]="item.closingStockQuantity < 0">
                {{ item.closingStockQuantity | ghmCurrency }}
            </td>
        </tr>
        </tbody>
        <tfoot>
        <tr>
            <td colspan="3" i18n="@@total" class="text-right bold">Total</td>
            <td class="text-right bold">{{ totalOpeningStockValue | ghmCurrency }}</td>
            <td class="text-right bold">{{ totalOpeningStockQuantity | ghmCurrency }}</td>
            <td class="text-right bold">{{ totalReceivingValue | ghmCurrency }}</td>
            <td class="text-right bold">{{ totalReceivingQuantity | ghmCurrency }}</td>
            <td class="text-right bold"
                [class.color-red]="totalDeliveringValue < 0">{{ totalDeliveringValue | ghmCurrency }}
            </td>
            <td class="text-right bold">{{ totalDeliveringQuantity | ghmCurrency }}
            </td>
            <td class="text-right bold">{{ totalClosingStockValue | ghmCurrency }}</td>
            <td class="text-right bold"
                [class.color-red]="totalClosingStockQuantity < 0">{{ totalClosingStockQuantity | ghmCurrency }}
            </td>
        </tr>
        </tfoot>
    </table>
</div><!-- END: .table-responsive -->

<ghm-paging
    class="pull-right"
    [totalRows]="totalRows"
    [currentPage]="currentPage"
    [pageShow]="6"
    [pageSize]="pageSize"
    (pageClick)="search($event)"
    i18n="@@product" i18n-pageName
    [pageName]="'product'">
</ghm-paging>

<app-goods-receipt-note-form
    (saveSuccessful)="search(1)"></app-goods-receipt-note-form>

<app-inventory-report-detail></app-inventory-report-detail>
