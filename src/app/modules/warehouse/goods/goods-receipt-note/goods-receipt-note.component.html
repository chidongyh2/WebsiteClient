<h1 class="page-title">
    <span class="cm-mgr-5" i18n="@@listSupplierPageTitle">Danh sách phiếu nhập kho</span>
    <small i18n="@@productModuleTitle">Quản lý kho</small>
</h1>
<form class="form-inline cm-mgb-10" (ngSubmit)="search(1)">
    <div class="form-group cm-mgr-5">
        <app-warehouse-suggestion
            (itemSelected)="onWarehouseSelected($event)"
            (itemRemoved)="onWarehouseRemoved()"></app-warehouse-suggestion>
    </div>
    <div class="form-group cm-mgr-5">
        <app-supplier-suggestion
            (itemRemoved)="onSupplierRemoved()"
            (itemSelected)="onSupplierSelected($event)"></app-supplier-suggestion>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-date [(ngModel)]="fromDate" name="fromDate" [mask]="true"
                 (selectedDateEvent)="search()"
                 (removedDateEvent)="search()"
                 [showTime]="true"
                 [allowRemove]="true"></nh-date>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-date [(ngModel)]="toDate" name="toDate" [mask]="true"
                 (selectedDateEvent)="search()"
                 (removedDateEvent)="search()"
                 [showTime]="true"
                 [allowRemove]="true"></nh-date>
    </div>
    <div class="form-group">
        <button class="btn blue" type="submit">
            <i class="fa fa-search" *ngIf="!isSearching"></i>
            <i class="fa fa-pulse fa-spinner" *ngIf="isSearching"></i>
        </button>
    </div>
    <div class="form-group cm-mgl-5">
        <button class="btn default" type="button" (click)="resetFormSearch()">
            <i class="fa fa-refresh"></i>
        </button>
    </div>
    <div class="form-group pull-right">
        <a class="btn blue cm-mgr-5" *ngIf="permission.add" i18n="@@add" (click)="add()"
           type="button">
            Thêm
        </a>
    </div>
</form>
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead>
        <tr>
            <th class="middle center w50" i18n="@@no">STT</th>
            <th class="middle" i18n="@@receiptNo">Số chứng từ</th>
            <th class="middle" i18n="@@invoiceNo">Số hóa đơn</th>
            <th class="middle" i18n="@@receiptType">Loại nhập</th>
            <th class="middle w150" i18n="@@entryDate">Ngày nhập</th>
            <th class="middle center" i18n="@@supplier">Nhà cung cấp</th>
            <th class="middle text-right" i18n="@@totalItems">Tổng sản phẩm</th>
            <!--<th class="middle" i18n="@@total">Total</th>-->
            <!--<th class="middle" i18n="@@discount">Discount</th>-->
            <th class="middle text-right" i18n="@@totalAmounts">Tổng tiền</th>
            <th class="middle" i18n="@@deliver">Người giao hàng</th>
            <th class="middle" i18n="@@receiver">Người nhận hàng</th>
            <th class="middle text-right w50" i18n="@@action" *ngIf="permission.edit || permission.delete">Hành động
            </th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let item of listItems$ | async; let i = index">
            <td class="center">{{ (currentPage - 1) * pageSize + i + 1 }}</td>
            <td>{{ item.receiptNo }}</td>
            <td>{{ item.invoiceNo }}</td>
            <td>
                <span class="badge"
                      [class.badge-info]="item.type === goodsReceiptNoteType.newPurchase"
                      [class.badge-danger]="item.type === goodsReceiptNoteType.customerReturn"
                      [class.badge-warning]="item.type === goodsReceiptNoteType.transfer"
                      [class.badge-default]="item.type === goodsReceiptNoteType.inventory">
                    {item.type, select, 0 {Nhập mua mới} 1 {Nhập khách trả} 2 {Nhập điều chuyển} 3 {Nhập kiểm kê} other{}}
                </span>
            </td>
            <td>{{ item.entryDate | dateTimeFormat:'DD/MM/YYYY HH:mm' }}</td>
            <td>{{ item.supplierName }}</td>
            <td class="text-right">{{ item.totalItems }}</td>
            <td class="text-right">{{ item.totalAmounts | ghmCurrency }}</td>
            <td>{{ item.deliverFullName }}</td>
            <td>{{ item.creatorFullName }}</td>
            <td class="text-right">
                <nh-dropdown>
                    <button type="button" class="btn btn-sm btn-no-background no-border" matTooltip="Menu">
                        <mat-icon>more_horiz</mat-icon>
                    </button>
                    <ul class="nh-dropdown-menu right">
                        <li *ngIf="permission.view" (click)="detail(item.id)">
                            <a href="javascript://">
                                <!--<i class="fa fa-eye"></i>-->
                                <mat-icon class="menu-icon">info</mat-icon>
                                <span i18n="@@detail">Chi tiết</span>
                            </a>
                        </li>
                        <li *ngIf="permission.edit && item.type === goodsReceiptNoteType.newPurchase"
                            (click)="edit(item.id)">
                            <a href="javascript://">
                                <!--<i class="fa fa-edit"></i>-->
                                <mat-icon class="menu-icon">edit</mat-icon>
                                <span i18n="@@edit">Chỉnh sửa</span>
                            </a>
                        </li>
                        <li *ngIf="permission.print" (click)="print(item.id)">
                            <a href="javascript://">
                                <!--<i class="fa fa-print menu-icon"></i>-->
                                <mat-icon class="menu-icon">print</mat-icon>
                                <span i18n="@@printReceipt">In hóa đơn</span>
                            </a>
                        </li>
                        <li *ngIf="permission.print" (click)="printBarcode(item.id)">
                            <a href="javascript://">
                                <!--<i class="fa fa-print menu-icon"></i>-->
                                <mat-icon class="menu-icon">print</mat-icon>
                                <span i18n="@@printBarcode">In mã vạch</span>
                            </a>
                        </li>
                    </ul><!-- END: nh-dropdown-menu -->
                </nh-dropdown>
            </td>
        </tr>
        </tbody>
    </table>
</div>

<ghm-paging
    class="pull-right"
    [totalRows]="totalRows"
    [currentPage]="currentPage"
    [pageShow]="6"
    [pageSize]="pageSize"
    (pageClick)="search($event)"
    i18n="@@product" i18n-pageName
    [pageName]="'product'">
</ghm-paging>

<swal
    #confirmDeleteProduct
    i18n="@@confirmDeleteProduct"
    i18n-title="@@confirmTitleDeleteProduct"
    i18n-text="@@confirmTextDeleteProduct"
    title="Are you sure for delete this product?"
    text="You can't recover this product after delete."
    type="question"
    i18n-confirmButtonText="@@accept"
    i18n-cancelButtonText="@@cancel"
    confirmButtonText="Accept"
    cancelButtonText="Cancel"
    [showCancelButton]="true"
    [focusCancel]="true">
</swal>

<div dynamic-component-host></div>

<app-goods-receipt-note-form
    (saveSuccessful)="onSaveSuccess($event)"></app-goods-receipt-note-form>

<nh-menu #nhMenu>
    <nh-menu-item (clicked)="detail($event.id)" *ngIf="permission.view">
        <!--<i class="fa fa-eye menu-icon"></i>-->
        <mat-icon class="menu-icon">info</mat-icon>
        <span i18n="@@detail">Chi tiết</span>
    </nh-menu-item>
    <nh-menu-item (clicked)="edit($event.id)"
                  *ngIf="permission.edit">
        <!--<i class="fa fa-edit menu-icon"></i>-->
        <mat-icon class="menu-icon">edit</mat-icon>
        <span i18n="@@edit">Chỉnh sửa</span>
    </nh-menu-item>
    <nh-menu-item (clicked)="print($event.id)" *ngIf="permission.print">
        <!--<i class="fa fa-print menu-icon"></i>-->
        <mat-icon class="menu-icon">print</mat-icon>
        <span i18n="@@printReceipt">In hóa đơn</span>
    </nh-menu-item>
    <nh-menu-item (clicked)="printBarcode($event.id)" *ngIf="permission.print">
        <!--<i class="fa fa-print menu-icon"></i>-->
        <mat-icon class="menu-icon">print</mat-icon>
        <span i18n="@@printBarcode">In mã vạch</span>
    </nh-menu-item>
</nh-menu>

<app-goods-receipt-note-print></app-goods-receipt-note-print>
<app-goods-receipt-note-print-barcode></app-goods-receipt-note-print-barcode>
