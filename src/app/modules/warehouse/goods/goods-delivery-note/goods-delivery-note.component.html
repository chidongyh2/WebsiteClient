<h1 class="page-title">
    <span class="cm-mgr-5" i18n="@@listGoodsDeliveryNoteTitle">Danh sách phiếu xuất kho</span>
    <small i18n="@@goodsNoteModuleTitle">Quản lý kho</small>
</h1>
<form class="form-inline cm-mgb-10" (ngSubmit)="search(1)">
    <div class="form-group cm-mgr-5">
        <app-warehouse-suggestion
            (itemSelected)="selectWarehouse($event)"
            (itemRemoved)="onWarehouseRemoved()"></app-warehouse-suggestion>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-date placeholder="Từ ngày"
                 i18n-placeholder="@@fromDate"
                 [(ngModel)]="fromDate"
                 [allowRemove]="true"
                 [mask]="true"
                 [showTime]="true"
                 (selectedDateEvent)="search(1)"
                 name="fromDate"></nh-date>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-date placeholder="Đến ngày"
                 i18n-placeholder="@@toDate"
                 [(ngModel)]="toDate"
                 [allowRemove]="true"
                 [mask]="true"
                 [showTime]="true"
                 (selectedDateEvent)="search(1)"
                 name="toDate"></nh-date>
    </div>
    <div class="form-group cm-mgr-5">
        <nh-select
            [title]="'Tất cả'"
            i18n-title="@@allFilter"
            [data]="listDeliveryType"
            [value]="type"
            (onSelectItem)="selectDeliveryType($event)"
        ></nh-select>
    </div>
    <div class="form-group cm-mgr-5">
        <input type="text" class="form-control" i18n="@@keywordSearch" i18n-placeholder
               placeholder="Nhập từ khóa tìm kiếm."
               name="searchInput" [(ngModel)]="keyword">
    </div>
    <div class="form-group">
        <button class="btn blue" type="submit">
            <i class="fa fa-search" *ngIf="!isSearching"></i>
            <i class="fa fa-pulse fa-spinner" *ngIf="isSearching"></i>
        </button>
    </div>
    <div class="form-group cm-mgl-5">
        <button class="btn default" type="button" (click)="resetFormSearch()">
            <i class="fa fa-refresh"></i>
        </button>
    </div>
    <div class="form-group pull-right">
        <nh-dropdown *ngIf="permission.add">
            <button type="button" class="btn blue" (click)="add()">
                <span i18n="@@add">Thêm</span>
            </button>
            <ul class="nh-dropdown-menu right" role="menu">
                <li>
                    <a href="javascript://">
                        <span i18n="@@retailDelivery">Xuất bán</span>
                    </a>
                </li>
                <li>
                    <a href="javascript://">
                        <span i18n="@@transferDelivery">Xuất điều chuyển</span>
                    </a>
                </li>
                <li>
                    <a href="javascript://">
                        <span i18n="@@voidedDelivery">Xuất hủy</span>
                    </a>
                </li>
            </ul>
        </nh-dropdown>
    </div>
</form>
<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th class="middle center w50" i18n="@@no">STT</th>
        <th class="middle" i18n="@@deliveryType">Hình thức xuất</th>
        <th class="middle text-right " i18n="@@totalAmount">Tổng tiền</th>
        <th class="middle" i18n="@@issuePerson">Người xuất</th>
        <th class="middle" i18n="@@deliveryDate">Ngày xuất</th>
        <th class="middle" i18n="@@warehouse">Kho xuất</th>
        <th class="middle text-right w150" i18n="@@action" *ngIf="permission.edit || permission.delete">Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let item of listItems$ | async; let i = index">
        <td class="middle center">{{(currentPage - 1) * pageSize + i + 1}}</td>
        <td class="middle">
            <span class="badge"
                  [class.badge-success]="item.type === deliveryType.retail"
                  [class.badge-info]="item.type === deliveryType.selfConsumer"
                  [class.badge-warning]="item.type === deliveryType.return"
                  [class.badge-danger]="item.type === deliveryType.voided"
                  [class.badge-defaut]="item.type === deliveryType.transfer"
                  [class.badge-defaut]="item.type === deliveryType.inventory"
                  i18n="@@goodsDeliveryNoteTypeValue">
                {item.type, select, 0 {Bán} 1 {Sử dụng} 2 {Trả nhà cung cấp} 3 {Hủy} 4 {Điều chuyển} 5 {Kiểm kê} other {}}
            </span>
        </td>
        <td class="middle text-right">{{ item.totalAmounts | ghmCurrency:0 }}</td>
        <td class="middle">{{ item.creatorFullName }}</td>
        <td class="middle">{{ item.deliveryDate | dateTimeFormat : 'DD/MM/YYYY HH:mm' }}</td>
        <td class="middle">{{ item.warehouseName }}</td>
        <td class="text-right middle" *ngIf="permission.edit || permission.delete">
            <nh-dropdown>
                <button type="button" class="btn btn-sm btn-light btn-no-background no-border" matTooltip="Menu">
                    <mat-icon>more_horiz</mat-icon>
                </button>
                <ul class="nh-dropdown-menu right" role="menu">
                    <li>
                        <a *ngIf="permission.edit"
                           (click)="detail(item)"
                           i18n="@@edit">
                            <!--<i class="fa fa-eye"></i>-->
                            <mat-icon class="menu-icon">info</mat-icon>
                            Chi tiết
                        </a>
                    </li>
                    <li>
                        <a *ngIf="permission.edit && item.type !== goodsDeliveryNoteType.inventory"
                           (click)="edit(item)"
                           i18n="@@edit">
                            <!--<i class="fa fa-edit"></i>-->
                            <mat-icon class="menu-icon">edit</mat-icon>
                            Chỉnh sửa
                        </a>
                    </li>
                </ul>
            </nh-dropdown>
        </td>
    </tr>
    </tbody>
</table>

<ghm-paging
    class="pull-right"
    [totalRows]="totalRows"
    [currentPage]="currentPage"
    [pageShow]="6"
    [pageSize]="pageSize"
    (pageClick)="search($event)"
    i18n="@@product" i18n-pageName
    [pageName]="'goodsDelivery'">
</ghm-paging>

<swal
    #confirmDelete
    i18n="@@confirmDelete"
    i18n-title="@@confirmTitleDeleteGoodsDelivery"
    i18n-text="@@confirmTextDeleteGoodsDelivery"
    title="Are you sure for delete this goods delivery?"
    text="You can't recover this goods delivery after delete."
    type="question"
    i18n-confirmButtonText="@@accept"
    i18n-cancelButtonText="@@cancel"
    confirmButtonText="Accept"
    cancelButtonText="Cancel"
    [showCancelButton]="true"
    [focusCancel]="true">
</swal>

<app-goods-delivery-note-form (saveSuccessful)="search(1)"></app-goods-delivery-note-form>
<app-goods-delivery-note-detail></app-goods-delivery-note-detail>
<app-goods-note-delivery-print></app-goods-note-delivery-print>

<nh-menu #nhMenu>
    <nh-menu-item (clicked)="detail($event)">
        <mat-icon class="menu-icon">info</mat-icon>
        <span i18n="@@view">Chi tiết</span>
    </nh-menu-item>
    <nh-menu-item (clicked)="edit($event)">
        <mat-icon class="menu-icon">edit</mat-icon>
        <span i18n="@@edit">Chỉnh sửa</span>
    </nh-menu-item>
</nh-menu>
