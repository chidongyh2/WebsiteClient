<nh-modal #productFormModal size="lg"
          (shown)="onModalShown()"
          (hidden)="onModalHidden()">
    <nh-modal-header class="uppercase font-green-sharp bold">
        <span
            i18n="@@productFormModalTitle">{isUpdate, select, 0 {Thêm mới sản phẩm} 1 {Cập nhật thông tin sản phẩm}}</span>
    </nh-modal-header>
    <form action="" class="form-horizontal" (ngSubmit)="save()" [formGroup]="model">
        <nh-modal-content>
            <div formArrayName="translations">
                <div class="form-group" *ngIf="languages && languages.length > 1">
                    <label i18n-ghmLabel="@@language" ghmLabel="Language"
                           class="col-sm-4 control-label"
                           [required]="true"></label>
                    <div class="col-sm-8">
                        <ghm-select [data]="languages"
                                    i18n-title="@@pleaseSelectLanguage"
                                    title="-- Please select language --"
                                    name="language"
                                    [(value)]="currentLanguage"
                                    (itemSelected)="currentLanguage = $event.id"></ghm-select>
                    </div>
                </div>
                <div class="form-group" [formGroup]="model"
                     [class.has-error]="formErrors?.categories">
                    <label class="control-label col-sm-4" i18n-ghmLabel="@@productCategory"
                           ghmLabel="Nhóm sản phẩm"
                           [required]="true"></label>
                    <div class="col-sm-8">
                        <nh-dropdown-tree [data]="categoryTree"
                                          [title]="id ? categoryText : 'Chọn nhóm sản phẩm'"
                                          [isMultiple]="true"
                                          formControlName="categories"
                                          (accepted)="onAcceptSelectCategory($event)">
                        </nh-dropdown-tree>
                        <span class="help-block">{formErrors?.categories, select, required {Product Category is required}}</span>
                    </div>
                </div><!-- END: Product category -->
                <div class="form-group"
                     *ngFor="let modelTranslation of translations.controls; index as i"
                     [formGroupName]="i"
                     [hidden]="modelTranslation.value.languageId !== currentLanguage"
                     [class.has-error]="translationFormErrors[modelTranslation.value.languageId]?.name">
                    <label class="col-sm-4 control-label" ghmLabel="Tên sản phẩm"
                           i18n-ghmLabel="@@productName"
                           [required]="true"></label>
                    <div class="col-sm-8">
                        <ghm-input
                            elementId="{{'name ' + currentLanguage}}"
                            formControlName="name"
                            placeholder="Nhập tên sản phẩm"
                            i18n-placeholder="@@enterProductName"></ghm-input>
                        <span class="help-block">
                                {
                                translationFormErrors[modelTranslation.value.languageId]?.name,
                                select, required {Vui lòng nhập tên sản phẩm.} maxlength {Tên sản phẩm không được vượt quá 256 ký tự.}
                                        pattern  {Tên sản phẩm phải là chữ.}
                                }
                            </span>
                    </div>
                </div><!-- END: Product name -->
                <div class="form-group"
                     *ngFor="let modelTranslation of translations.controls; index as i"
                     [formGroupName]="i"
                     [hidden]="modelTranslation.value.languageId !== currentLanguage"
                     [class.has-error]="translationFormErrors[modelTranslation.value.languageId]?.seoLink">
                    <label class="col-sm-4 control-label" ghmLabel="SeoLink"
                           i18n-ghmLabel="@@description"></label>
                    <div class="col-sm-8">
                                    <input name="" class="form-control" rows="3"
                                              formControlName="seoLink"
                                              placeholder="Nhập seolink"
                                              i18n-placeholder="@@enterDescription"/>
                        <span class="help-block">
                            {
                            translationFormErrors[modelTranslation.value.languageId]?.seolink,
                            select, maxlength {SeoLink không được phép vượt quá 500 ký tự.}
                            }
                        </span>
                    </div>
                </div>
                <div class="form-group"
                     *ngFor="let modelTranslation of translations.controls; index as i"
                     [formGroupName]="i"
                     [hidden]="modelTranslation.value.languageId !== currentLanguage"
                     [class.has-error]="translationFormErrors[modelTranslation.value.languageId]?.description">
                    <label class="col-sm-4 control-label" ghmLabel="Mô tả"
                           i18n-ghmLabel="@@description"></label>
                    <div class="col-sm-8">
                                    <textarea name="" class="form-control" rows="3"
                                              formControlName="description"
                                              placeholder="Nhập nội dung mô tả"
                                              i18n-placeholder="@@enterDescription"></textarea>
                        <span class="help-block">
                            {
                            translationFormErrors[modelTranslation.value.languageId]?.description,
                            select, maxlength {Thông tin mô tả sản phẩm không được phép vượt quá 500 ký tự.}
                            }
                        </span>
                    </div>
                </div><!-- END: Product description -->
            </div>
            <div class="form-group"
                 [class.has-error]="formErrors?.unitId">
                <label class="col-sm-4 control-label" ghmLabel="Đơn vị tính"
                       i18n-ghmLabel="@@productUnit"
                       [required]="true"></label>
                <div class="col-sm-8">
                    <app-unit-suggestion
                        [selectedItem]="model.value.unitId ? {id: model.value.unitId, name: model.value.unitName} : null"
                        (itemSelected)="onUnitSelected($event)"
                        (itemRemoved)="onUnitRemoved()"></app-unit-suggestion>
                    <span class="help-block">{formErrors?.unitId, select, required {Vui lòng chọn đơn vị tính} maxlength {Đơn vị tính không được phép vượt quá 50 ký tự.}}</span>
                </div>
            </div>
            <div class="form-group"
                 [class.has-error]="formErrors?.salePrice">
                <label class="col-sm-4 control-label" ghmLabel="Giá bán"
                       i18n-ghmLabel="@@salePrice"
                       [required]="true"></label>
                <div class="col-sm-4">
                    <div class="input-group">
                        <dx-number-box placeholder="Giá bán" formControlName="salePrice" format="#,##0"
                                       [showClearButton]="true"></dx-number-box>
                        <span class="input-group-addon">
                            VNĐ
                        </span>
                    </div>
                    <span class="help-block">{formErrors?.salePrice, select, required {Vui lòng chọn giá bán} isValid {Giá bán phải là số.}}</span>
                </div>
            </div>
            <!--<div class="form-group"-->
                 <!--[class.has-error]="formErrors?.isManagementByLot">-->
                <!--<div class="col-sm-8 col-sm-offset-4">-->
                    <!--<dx-check-box formControlName="isManagementByLot" text="Quản lý theo lô"></dx-check-box>-->
                <!--</div>-->
            <!--</div>-->
            <div class="form-group"
                 [class.has-error]="formErrors?.isActive">
                <div class="col-sm-8 col-sm-offset-4">
                    <dx-check-box formControlName="isActive" text="Kích hoạt"></dx-check-box>
                </div>
            </div>
            <div class="form-group"
                 [class.has-error]="formErrors?.isHot">
                <div class="col-sm-8 col-sm-offset-4">
                    <dx-check-box formControlName="isHot" text="Sản phẩm nổi bật"></dx-check-box>
                </div>
            </div>
            <div class="form-group"
                 [class.has-error]="formErrors?.isHomePage">
                <div class="col-sm-8 col-sm-offset-4">
                    <dx-check-box formControlName="isHomePage" text="Hiển thị trang chủ"></dx-check-box>
                </div>
            </div>
            <mat-accordion class="example-headers-align ">
                <div class="cm-mgb-10">
                    <mat-expansion-panel hideToggle>
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <span i18n="@@unitConversion">Hình ảnh sản phẩm</span>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <ghm-file-explorer i18n-buttonText="@@selectImage"
                                           [multiple]="true"
                                           i18n-buttonText="@@selectProductImage"
                                           [buttonText]="'Chọn ảnh sản phẩm'"
                                           (itemSelected)="selectProductImage($event)"
                                           (acceptSelected)="uploadImageProduct($event)"></ghm-file-explorer>
                        <div class="product-images">
                            <div class="image-content" *ngFor="let item of productImages"
                                 [class.thumbnail]="item.isThumbnail">
                                <img ghmImage [src]="item.url"
                                     [nhImageViewer]="urlFile + item.url"
                                     [errorImageUrl]="'/assets/images/no-image.png'">
                                <button class="btn btn-sm btn-remove red" type="button"
                                        [swal]="confirmDeleteImage"
                                        (confirm)="removeImage(item)">
                                    <i class="fa fa-times"></i>
                                </button>
                                <button class="btn btn-sm btn-check blue"
                                        [class.display-none]="!item.isThumbnail" (click)="checkThumbnail(item)"
                                        type="button">
                                    <i class="fa fa-circle-o" aria-hidden="true" *ngIf="!item.isThumbnail"></i>
                                    <i class="fa fa-check" aria-hidden="true" *ngIf="item.isThumbnail">
                                    </i>
                                </button>
                            </div>
                        </div>
                    </mat-expansion-panel><!-- END: Product images -->
                </div>
                <!--<div class="cm-mgb-10">-->
                    <!--<mat-expansion-panel hideToggle>-->
                        <!--<mat-expansion-panel-header>-->
                            <!--<mat-panel-title>-->
                                <!--<span i18n="@@unitConversion">Đơn vị chuyển đổi</span>-->
                            <!--</mat-panel-title>-->
                        <!--</mat-expansion-panel-header>-->
                        <!--<table class="table table-stripped table-hover"-->
                               <!--*ngIf="model.value.unitName; else selectDefaultUnitTemplate"-->
                               <!--formArrayName="conversionUnits">-->
                            <!--<thead>-->
                            <!--<tr>-->
                                <!--<th i18n="@@unit">Đơn vị</th>-->
                                <!--<th></th>-->
                                <!--<th i18n="@@conversion" class="w100">Chuyển đổi</th>-->
                                <!--<th i18n="@@unit">Đơn vị</th>-->
                                <!--<th i18n="@@salePrice" class="text-right">Giá bán</th>-->
                            <!--</tr>-->
                            <!--</thead>-->
                            <!--<tbody>-->
                            <!--<tr *ngFor="let item of conversionUnits.controls; let i = index"-->
                                <!--[formGroupName]="i">-->
                                <!--<td>-->
                                    <!--<app-unit-suggestion-->
                                        <!--[selectedItem]="item.value.unitId ? {id: item.value.unitId, name: item.value.unitName} : null"-->
                                        <!--(itemSelected)="onConversionUnitSelected($event, item, i)"-->
                                        <!--(itemRemoved)="onConversionUnitRemoved(i)"></app-unit-suggestion>-->
                                <!--</td>-->
                                <!--<td class="center middle">=</td>-->
                                <!--<td>-->
                                    <!--<dx-number-box [class.has-error]="conversionFormErrors[i]?.value"-->
                                                   <!--formControlName="value" format="#,##0"-->
                                                   <!--id="conversionValue{{i}}"-->
                                                   <!--name="conversionValue{{i}}"></dx-number-box>-->
                                    <!--&lt;!&ndash;<input type="text" class="form-control text-right"&ndash;&gt;-->
                                    <!--&lt;!&ndash;[class.has-error]="conversionFormErrors[i]?.value"&ndash;&gt;-->
                                    <!--&lt;!&ndash;ghm-text-selection&ndash;&gt;-->
                                    <!--&lt;!&ndash;formControlName="value"&ndash;&gt;-->
                                    <!--&lt;!&ndash;id="conversionValue{{i}}"&ndash;&gt;-->
                                    <!--&lt;!&ndash;name="conversionValue{{i}}">&ndash;&gt;-->
                                <!--</td>-->
                                <!--<td class="middle">-->
                                    <!--{{ model.value.unitName }}-->
                                <!--</td>-->
                                <!--<td>-->
                                    <!--<div class="input-group">-->
                                        <!--<dx-number-box formControlName="salePrice" format="#,##0"-->
                                                       <!--[showClearButton]="true" cssClass="pull-right"></dx-number-box>-->
                                        <!--<span class="input-group-addon">-->
                                            <!--VNĐ-->
                                        <!--</span>-->
                                    <!--</div>-->
                                    <!--&lt;!&ndash;<input type="text" class="form-control text-right" formControlName="salePrice">&ndash;&gt;-->
                                <!--</td>-->
                            <!--</tr>-->
                            <!--</tbody>-->
                        <!--</table>-->
                        <!--<ng-template #selectDefaultUnitTemplate>-->
                            <!--<div i18n="@@pleaseSelectUnit" class="alert alert-info">Vui lòng chọn đơn vị.</div>-->
                        <!--</ng-template>-->
                    <!--</mat-expansion-panel>&lt;!&ndash; END: Product unit conversion &ndash;&gt;-->
                <!--</div>-->
                <div class="cm-mgb-10">
                    <mat-expansion-panel hideToggle>
                        <mat-expansion-panel-header>
                            <mat-panel-title>
                                <span i18n="@@productAttribute">Thuộc tính sản phẩm</span>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="table-responsive">
                            <table class="table table-hover table-striped"
                                   formArrayName="attributes">
                                <thead>
                                <tr>
                                    <th class="middle w200" i18n="@@productAttribute">Thuộc tính sản phẩm</th>
                                    <th class="middle" i18n="@@productAttributeValue">Giá trị thuộc tính sản phẩm</th>
                                    <th class="middle center" i18n="@@websiteVisible">Hiển thị website</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr *ngFor="let item of attributes.controls; let i = index"
                                    [formGroupName]="i">
                                    <td>
                                        <ng-container *ngIf="!isReadOnly">
                                            <app-product-attribute-suggestion
                                                [selectedItem]="item.value.attributeId ? {id: item.value.attributeId, name: item.value.attributeName} : null"
                                                (itemSelected)="onAttributeSelected($event, item, i)"
                                                (itemRemoved)="onAttributeRemoved(i)"></app-product-attribute-suggestion>
                                        </ng-container>
                                    </td>
                                    <td>
                                        <ng-container *ngIf="!item.value.isSelfContent; else selfContentTemplate">
                                            <app-product-attribute-value-suggestion
                                                [class.has-error]="attributeFormErrors[i].productAttributeValues"
                                                [multiple]="item.value.isMultiple"
                                                [attributeId]="item.value.attributeId"
                                                [selectedItem]="item.value.attributeValues ? item.value.attributeValues : []"
                                                (itemSelected)="onProductAttributeValueSelected($event, item, i)"
                                                (itemRemoved)="onProductAttributeValueRemoved(item)"></app-product-attribute-value-suggestion>
                                        </ng-container>
                                        <ng-template #selfContentTemplate>
                                        <textarea type="text" formControlName="value" class="form-control"
                                                  [class.has-error]="attributeFormErrors[i].value"
                                                  placeholder="Nhập nội dung"
                                                  i18n-placeholder="@@enterContent"></textarea>
                                        </ng-template>
                                    </td>
                                    <td class="center middle">
                                        <dx-check-box formControlName="isShowClient"></dx-check-box>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </mat-expansion-panel><!-- END: Product attribute -->
                </div>
            </mat-accordion>
        </nh-modal-content>
        <nh-modal-footer>
            <div class="form-group">
                <div class="pull-right cm-mgrl-15">
                    <dx-check-box *ngIf="!isUpdate" [(value)]="isCreateAnother" text="Tiếp tục tạo"></dx-check-box>
                    <button class="btn blue cm-mgr-5" i18n="@@save"
                            [disabled]="isSaving">
                        <i class="fa fa-spinner" *ngIf="isSaving"></i>
                        Lưu
                    </button>
                    <button type="button" class="btn default" i18n="@@close" nh-dismiss
                            [disabled]="isSaving">
                        Đóng
                    </button>
                </div>
            </div>
        </nh-modal-footer>
    </form>
</nh-modal>

<swal
    #confirmDeleteImage
    i18n="@@confirmDeleteImage"
    i18n-title="@@confirmTitleDeleteImage"
    i18n-text="@@confirmTextDeleteImage"
    title="Are you sure for delete this Image?"
    type="question"
    i18n-confirmButtonText="@@accept"
    i18n-cancelButtonText="@@cancel"
    confirmButtonText="Accept"
    cancelButtonText="Cancel"
    [showCancelButton]="true"
    [focusCancel]="true">
</swal>
